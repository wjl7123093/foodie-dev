<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.snow.mapper.ItemsCommentsMapperCustom">

  <!-- 保存评论列表 -->
  <select id="saveComments" parameterType="Map">

    INSERT INTO
      items_comments
      (
        id,
        user_id,
        item_id,
        item_name,
        item_spec_id,
        sepc_name,
        comment_level,
        content,
        created_time,
        updated_time
      )
    VALUES
      <foreach collection="commentList" index="index" item="item" separator=", ">
        (
          #{item.commentId},
          #{userId},
          #{item.itemId},
          #{item.itemName},
          #{item.itemSpecId},
          #{item.itemSpecName},
          #{item.commentLevel},
          #{item.content},
          now(),
          now()
        )
      </foreach>

  </select>

  <resultMap id="myComments" type="com.snow.pojo.vo.MyCommentVO">
     <id column="commentId" property="commentId"></id>
     <result column="content" property="content"></result>
     <result column="createdTime" property="createdTime"></result>
     <result column="itemId" property="itemId"></result>
     <result column="itemName" property="itemName"></result>
     <result column="specName" property="specName"></result>
     <result column="itemImg" property="itemImg"></result>
  </resultMap>

  <!-- 查询我的评论 -->
  <select id="queryMyComments" parameterType="Map" resultMap="myComments">
    SELECT
        ic.id as commentId,
        ic.content as content,
        ic.created_time as createdTime,
        ic.item_id as itemId,
        ic.item_name as itemName,
        ic.sepc_name as specName,
        ii.url as itemImg
    FROM
        items_comments ic
    LEFT JOIN
        items_img ii
    ON
        ic.item_id = ii.item_id
    WHERE
        ic.user_id = #{paramsMap.userId}
    AND
        ii.is_main = 1

  </select>
  
</mapper>